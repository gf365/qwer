
<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Space+Grotesk%3Awght%40400%3B500%3B700"
    />

    <title>検索結果 - QWER</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />

        <link rel="stylesheet" href="{{ '/assets/css/site.css' | relative_url }}" />
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  </head>
  <body>
    <div class="page-shell">
      <div class="layout-container flex h-full grow flex-col">
        {% include header.html %}
        <main class="page-main">
          <div class="page-content">
            <section class="hero-panel">
              <p class="section-eyebrow">Search</p>
              <h1 id="search-title">検索結果</h1>
              <p>学習ログ / テンプレ / ポリシーなど、QWER Atlas内のコンテンツを横断検索します。タグやカテゴリも含めて全文検索できるため、過去のナレッジへすばやく到達できます。</p>
            </section>
            <section class="surface-card section-stack">
              <h2 class="section-heading">結果一覧</h2>
              <div id="search-results" class="section-stack" aria-live="polite"></div>
            </section>
          </div>
        </main>
        {% include footer.html %}
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const searchTitle = document.getElementById('search-title');
        const resultsContainer = document.getElementById('search-results');
        const query = new URLSearchParams(window.location.search).get('q');

        // 検索対象のファイルリスト (手動で定義)
        const searchableFiles = [
          './index.html',
          './about.html',
          './contact.html',
          './discover.html',
          './explore.html',
          './join.html',
          './privacy.html',
          './signin.html',
          './signup.html',
          './terms.html'
        ];

        if (query) {
          searchTitle.textContent = `「${query}」の検索結果`;
          resultsContainer.innerHTML = '<p class="section-text">検索中...</p>';
          search(query, searchableFiles, resultsContainer);
        } else {
          searchTitle.textContent = '検索語を入力してください';
          resultsContainer.innerHTML = '<p class="section-text">検索バーからキーワードを入力してください。</p>';
        }
      });

      async function search(query, files, container) {
        const results = [];
        
        for (const file of files) {
          try {
            const response = await fetch(file);
            if (!response.ok) {
              console.error(`Error fetching ${file}: ${response.statusText}`);
              continue;
            }
            const html = await response.text();
            
            // 簡単な文字列検索
            if (html.toLowerCase().includes(query.toLowerCase())) {
              // DOMをパースしてタイトルを取得
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, 'text/html');
              const title = doc.querySelector('title')?.textContent || file;
              
              results.push({ file, title });
            }
          } catch (error) {
            console.error(`Error processing ${file}:`, error);
          }
        }
        
        displayResults(results, container);
      }

      function displayResults(results, container) {
        container.innerHTML = ''; // 古い結果をクリア

        if (results.length === 0) {
          container.innerHTML = '<p class="section-text">一致する結果は見つかりませんでした。</p>';
          return;
        }

        results.forEach(result => {
          const card = document.createElement('a');
          card.href = result.file;
          card.className = 'surface-card';

          const title = document.createElement('h3');
          title.textContent = result.title;
          card.appendChild(title);

          const description = document.createElement('p');
          description.className = 'section-text';
          description.textContent = 'クリックして詳細ページを表示';
          card.appendChild(description);

          container.appendChild(card);
        });
      }
    </script>
  </body>
</html>
